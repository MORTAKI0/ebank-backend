# T4 - Model and DB constraints (manual SQL)

Why no Flyway/Liquibase
- This project does not include Flyway or Liquibase dependencies or config.
- To avoid adding new tooling, the schema changes are applied manually in PostgreSQL.

How to run on Supabase (SQL editor)
1) Open the Supabase dashboard for the project.
2) Go to SQL Editor.
3) Paste the contents of `db/manual/T4_add_columns_and_constraints.sql`.
4) Run the script and review output.

Verification queries
-- Columns and nullability
SELECT column_name, is_nullable, character_maximum_length
FROM information_schema.columns
WHERE table_name = 'bank_account_transactions'
  AND column_name IN ('label', 'motif')
ORDER BY column_name;

-- Unique constraints
SELECT conname, conrelid::regclass AS table_name, pg_get_constraintdef(oid) AS def
FROM pg_constraint
WHERE conname IN ('uk_customers_identity_ref', 'uk_customers_email', 'uk_bank_accounts_rib')
ORDER BY conname;

-- Indexes
SELECT indexname, indexdef
FROM pg_indexes
WHERE indexname IN ('idx_customers_identity_ref', 'idx_customers_email', 'idx_bank_accounts_rib')
ORDER BY indexname;

Notes
- Check for duplicate `customers.identity_ref`, `customers.email`, and `bank_accounts.rib` before applying the unique constraints.
- If duplicates exist, clean them up first or the script will fail when adding constraints.
